FROM mcr.microsoft.com/windows/servercore:ltsc2019

# Download and install Visual Studio Build Tools
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop'; $ProgressPreference = 'SilentlyContinue';"]
RUN Invoke-WebRequest -Uri "https://aka.ms/vs/16/release/vs_buildtools.exe" -OutFile "C:\vs_buildtools.exe"; \
    Start-Process -FilePath "C:\vs_buildtools.exe" -ArgumentList "--quiet", "--wait", "--norestart", "--nocache", \
    "--installPath C:\BuildTools", \
    "--add Microsoft.VisualStudio.Workload.VCTools", \
    "--add Microsoft.VisualStudio.Component.VC.Tools.x86.x64", \
    "--add Microsoft.VisualStudio.Component.VC.CMake.Project", \
    "--add Microsoft.VisualStudio.Component.Windows10SDK.17763" -NoNewWindow -Wait

# Install CMake
ADD https://github.com/Kitware/CMake/releases/download/v3.21.1/cmake-3.21.1-windows-x86_64.msi cmake-installer.msi
RUN msiexec.exe /i cmake-installer.msi /quiet /norestart

# Make cmake available in PATH
RUN setx /M PATH "%PATH%;C:\Program Files\CMake\bin"
